# Docker Compose override for macOS + Rancher Desktop
# Usage: docker compose -f docker-compose.yml -f docker-compose.rancher.yml up -d
#
# Note: Rancher Desktop (Lima-based) cannot mount macOS Unix sockets directly.
# SSH agent forwarding is not available in this configuration.
# Use SSH keys mounted as files instead.

services:
  coding-agent:
    # Override volumes completely (docker compose merges arrays, so we must redefine all)
    volumes:
      - ../:/workspace:cached
      # Mount SSH keys (read-only) for git operations - no socket forwarding
      - ${HOME}/.ssh/id_ed25519:/home/agent/.ssh-host/id_ed25519:ro
      - ${HOME}/.ssh/id_ed25519.pub:/home/agent/.ssh-host/id_ed25519.pub:ro
      - ${HOME}/.ssh/known_hosts:/home/agent/.ssh-host/known_hosts:ro
      - agent-config:/home/agent/.config
    environment:
      # Override SSH_AUTH_SOCK to disable socket-based auth
      - SSH_AUTH_SOCK=
